$(function(){var e=document.querySelector(".pp_upload .pp_modal_image"),o=document.querySelector(".pp_upload .pp_input");if(null!==o){var t,a=document.querySelector(".pp_upload .pp_modal_image_edit"),n=document.querySelector(".pp_new"),d=$(".pp_new img"),p=$(".pp_upload .pp_crop"),i=$(".pp_upload .pp_data"),l={aspectRatio:1,viewMode:1,dragMode:"move"},c=new Custombox.modal({content:{effect:"fadein",target:".pp_modal"}});o.addEventListener("change",function(t){var a,n,d=t.target.files,p=function(t){o.value="",e.src=t,c.open()};d&&d.length>0&&(n=d[0],URL?p(URL.createObjectURL(n)):FileReader&&((a=new FileReader).onload=function(e){p(a.result)},a.readAsDataURL(n)))}),document.addEventListener("custombox:content:open",function(){document.querySelector(".pp_modal").style.display="block",t=new Cropper(e,l)}),document.addEventListener("custombox:overlay:close",function(){document.querySelector(".pp_modal").style.display="none",t.destroy(),t=null}),a.onclick=function(o){var a,n,d,p,i=o||window.event,c=i.target||i.srcElement;if(console.info(c),t){for(;c!==this&&!c.getAttribute("data-method");)c=c.parentNode;if(!(c===this||c.disabled||c.className.indexOf("disabled")>-1)&&(p={method:c.getAttribute("data-method"),target:c.getAttribute("data-target"),option:c.getAttribute("data-option")||void 0,secondOption:c.getAttribute("data-second-option")||void 0},a=t.cropped,p.method)){if(void 0!==p.target&&(d=document.querySelector(p.target),!c.hasAttribute("data-option")&&p.target&&d))try{p.option=JSON.parse(d.value)}catch(i){console.log(i.message)}switch(p.method){case"rotate":a&&l.viewMode>0&&t.clear();break;case"getCroppedCanvas":try{p.option=JSON.parse(p.option)}catch(i){console.log(i.message)}"image/jpeg"===uploadedImageType&&(p.option||(p.option={}),p.option.fillColor="#fff")}switch(n=t[p.method](p.option,p.secondOption),p.method){case"rotate":a&&l.viewMode>0&&t.crop();break;case"scaleX":case"scaleY":c.setAttribute("data-option",-p.option);break;case"getCroppedCanvas":n&&(download.disabled||(download.download=uploadedImageName,download.href=n.toDataURL(uploadedImageType)));break;case"destroy":t=null,uploadedImageURL&&(URL.revokeObjectURL(uploadedImageURL),uploadedImageURL="",e.src=originalImageURL)}if("object"==typeof n&&n!==t&&d)try{d.value=JSON.stringify(n)}catch(i){console.log(i.message)}}}},$(p).on("click",function(){var e;t&&(e=t.getCroppedCanvas({width:$profilepic_size,height:$profilepic_size}).toDataURL(),i.val(e).trigger("change"),n.style.display="block",d.attr("src",e)),Custombox.modal.closeAll()}),$(".pp_file_input").on("change",function(){$(this).on("focus",function(){$(this).addClass("has-focus")}).on("blur",function(){$(this).removeClass("has-focus")})}),i.on("change",function(){$(this).val()?$("label[for=pp_input_]").find("span").html($profilepic_uploaded):$("label[for=pp_input_]").find("span").html($profilepic_not_uploaded)})}});
